
#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Quick validation before push
echo "Running pre-push checks..."

# 1. Type checking for affected projects
echo "ğŸ“ Type checking..."
yarn nx affected --target=typecheck --base=origin/develop --head=HEAD --parallel=3
if [ $? -ne 0 ]; then
    echo "âŒ Type checking failed. Please fix TypeScript errors before pushing."
    exit 1
fi

# 2. Linting for affected projects
echo "ğŸ” Linting..."
yarn nx affected:lint --base=origin/develop --head=HEAD --parallel=3
if [ $? -ne 0 ]; then
    echo "âŒ Linting failed. Please fix linting errors before pushing."
    exit 1
fi

# 3. Unit tests for affected projects (excluding e2e)
echo "ğŸ§ª Running unit tests..."
yarn nx affected:test --base=origin/develop --head=HEAD --exclude=e2e --parallel=3
if [ $? -ne 0 ]; then
    echo "âŒ Unit tests failed. Please fix failing tests before pushing."
    exit 1
fi

echo "âœ… All pre-push checks passed!"

# Note: Integration and E2E tests will run in GitHub Actions
echo "â„¹ï¸  Integration and E2E tests will run in CI/CD pipeline."