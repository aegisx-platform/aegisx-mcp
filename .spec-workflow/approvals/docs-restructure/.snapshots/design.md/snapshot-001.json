{
  "id": "snapshot_1765726414742_gcnwlins0",
  "approvalId": "approval_1765726414730_x7xheqg9g",
  "approvalTitle": "Design: Documentation Restructuring",
  "version": 1,
  "timestamp": "2025-12-14T15:33:34.742Z",
  "trigger": "initial",
  "status": "pending",
  "content": "# Design Document\n\n## Overview\n\nThis design document outlines the complete restructuring of the AegisX Platform documentation system (`docs/`) to create a standardized, maintainable, and web-ready documentation structure. The restructuring will transform 476 markdown files from an inconsistent organization into a clean Information Architecture suitable for both human navigation and static site generation.\n\n**Key Design Goals:**\n1. **Discoverability** - Developers can find documentation quickly using predictable paths\n2. **Maintainability** - Consistent structure reduces confusion and duplication\n3. **Web-Ready** - Structure and metadata support VitePress, Docusaurus, or MkDocs\n4. **Progressive Disclosure** - Overview → Guides → Reference → Deep Dives\n\n## Steering Document Alignment\n\n### Technical Standards (tech.md)\n\nThis restructuring follows AegisX Platform's technical standards:\n- **Documentation as Code** - Version controlled, reviewed, and tested like source code\n- **Markdown-First** - All documentation in GitHub-flavored Markdown with Mermaid diagrams\n- **Metadata-Driven** - YAML frontmatter enables automation and web generation\n- **Git Workflow** - Use `git mv` to preserve history during file moves\n\n### Project Structure (structure.md)\n\nThe documentation structure mirrors the monorepo organization:\n- `docs/reference/` maps to actual API endpoints and components\n- `docs/features/` maps to feature directories in codebase\n- `docs/architecture/` reflects backend/, frontend/, database/ layers\n- `docs/guides/` provides cross-cutting development and infrastructure guides\n\n## Code Reuse Analysis\n\n### Existing Components to Leverage\n\n- **Feature Documentation Templates** - Several features (api-keys, authentication, users) already use standardized templates with DOCUMENTATION_INDEX.md\n- **Markdown Validation** - Existing linting and validation scripts can be extended\n- **CI/CD Pipeline** - GitHub Actions can build and deploy web documentation\n- **Mermaid Diagrams** - Already widely used; will become standard for architecture docs\n\n### Integration Points\n\n- **VitePress/Docusaurus** - Popular static site generators with Vue/React ecosystems\n- **GitHub Pages** - Existing infrastructure for hosting documentation\n- **Search Indexing** - Frontmatter metadata enables better search (Algolia, Meilisearch)\n- **Link Validation** - CI/CD can validate internal links during builds\n\n## Architecture\n\n### New Documentation Structure\n\n```\ndocs/\n├── README.md                        # Master index and navigation hub\n├── metadata-schema.md               # Frontmatter schema and controlled vocabulary\n│\n├── getting-started/                 # Quick start and onboarding\n│   ├── README.md                    # Getting started hub\n│   ├── installation.md              # Setup instructions\n│   ├── first-steps.md               # Hello world tutorial\n│   └── project-overview.md          # High-level architecture overview\n│\n├── guides/                          # How-to guides (task-oriented)\n│   ├── README.md                    # Guides index\n│   ├── development/                 # Development guides\n│   │   ├── README.md\n│   │   ├── feature-development-standard.md\n│   │   ├── api-calling-standard.md\n│   │   ├── qa-checklist.md\n│   │   ├── universal-fullstack-standard.md\n│   │   └── claude-detailed-rules.md\n│   ├── infrastructure/              # Infrastructure and DevOps guides\n│   │   ├── README.md\n│   │   ├── multi-instance-setup.md\n│   │   ├── git-subtree-guide.md\n│   │   ├── ci-cd/\n│   │   │   ├── README.md\n│   │   │   ├── quick-start.md\n│   │   │   ├── deployment-guide.md\n│   │   │   └── dns-setup-guide.md\n│   │   ├── docker/\n│   │   │   ├── README.md\n│   │   │   ├── monorepo-docker-guide.md\n│   │   │   └── multi-instance-docker-workflow.md\n│   │   └── version-management/\n│   │       ├── README.md\n│   │       ├── git-flow-release-guide.md\n│   │       ├── automated-versioning-guide.md\n│   │       └── semantic-release-recovery.md\n│   ├── database/                    # Database guides\n│   │   ├── README.md\n│   │   ├── migration-guide.md\n│   │   ├── schema-migration-guide.md\n│   │   └── seed-system.md\n│   └── testing/                     # Testing guides\n│       ├── README.md\n│       ├── testing-strategy.md\n│       ├── api-testing.md\n│       └── integration-tests.md\n│\n├── reference/                       # Technical reference (information-oriented)\n│   ├── README.md                    # Reference index\n│   ├── api/                         # API documentation\n│   │   ├── README.md\n│   │   ├── api-response-standard.md\n│   │   ├── typebox-schema-standard.md\n│   │   ├── bulk-operations-api-design.md\n│   │   └── file-upload-guide.md\n│   ├── ui/                          # UI component reference\n│   │   ├── README.md\n│   │   ├── aegisx-ui-standards.md\n│   │   ├── theme-system-standard.md\n│   │   └── components/\n│   │       ├── badge.md\n│   │       ├── breadcrumb.md\n│   │       └── dialog-standard.md\n│   ├── cli/                         # CLI tools reference\n│   │   ├── README.md\n│   │   ├── aegisx-cli/              # Symlink or copy from libs/aegisx-cli/docs\n│   │   │   ├── README.md\n│   │   │   ├── quick-reference.md\n│   │   │   ├── complete-workflow.md\n│   │   │   └── websocket-implementation-spec.md\n│   │   └── commands/\n│   │       ├── feature-commands.md\n│   │       └── quick-commands.md\n│   └── libraries/                   # Library standards\n│       ├── README.md\n│       ├── library-standards.md\n│       └── fastify-plugin-standards.md\n│\n├── architecture/                    # Architecture documentation (understanding-oriented)\n│   ├── README.md                    # Architecture hub\n│   ├── overview.md                  # System architecture overview\n│   ├── domain-architecture-guide.md # Domain-driven design\n│   ├── quick-domain-reference.md\n│   ├── backend/                     # Backend architecture\n│   │   ├── README.md\n│   │   ├── api-standards/\n│   │   │   ├── architecture-specification.md\n│   │   │   ├── migration-patterns.md\n│   │   │   └── plugin-migration-guide.md\n│   │   ├── fastify-plugins.md\n│   │   ├── rbac-auth.md\n│   │   ├── event-bus-system.md\n│   │   └── websocket-realtime.md\n│   ├── frontend/                    # Frontend architecture\n│   │   ├── README.md\n│   │   ├── angular-signals-patterns.md\n│   │   ├── routing-navigation.md\n│   │   ├── auth-guards.md\n│   │   └── ui-design-system.md\n│   ├── database/                    # Database architecture\n│   │   ├── README.md\n│   │   ├── migrations/\n│   │   └── seeds/\n│   └── apps/                        # Application-specific architecture\n│       ├── admin/\n│       │   ├── README.md\n│       │   ├── architecture.md\n│       │   ├── components.md\n│       │   └── patterns.md\n│       └── inventory/\n│           ├── README.md\n│           ├── database-architecture.md\n│           └── migration-standards.md\n│\n├── features/                        # Feature-specific documentation\n│   ├── README.md                    # Feature catalog\n│   ├── {feature-name}/              # Standard feature documentation structure\n│   │   ├── README.md                # Feature overview\n│   │   ├── api-reference.md         # API endpoints\n│   │   ├── architecture.md          # Feature architecture\n│   │   ├── developer-guide.md       # Implementation guide\n│   │   ├── user-guide.md            # End-user documentation\n│   │   ├── troubleshooting.md       # Common issues\n│   │   └── deployment-guide.md      # Deployment instructions\n│   └── templates/                   # Feature documentation templates\n│       └── feature-documentation-standard.md\n│\n├── analysis/                        # Technical analysis and research\n│   ├── README.md\n│   ├── migration/\n│   │   ├── knex-to-drizzle-migration.md\n│   │   └── files-to-migrate.md\n│   └── platform/\n│       ├── platform-gap-analysis.md\n│       └── fuse-integration-summary.md\n│\n├── reports/                         # Audit and review reports\n│   ├── README.md\n│   ├── api-endpoint-audit-report.md\n│   ├── performance-report.md\n│   └── jwt-security-audit.md\n│\n└── archive/                         # Historical documentation\n    ├── README.md                    # Archive index\n    ├── 2024-Q4/                     # Quarterly archives\n    │   ├── sessions-archive.md      # Consolidated session notes\n    │   └── investigations/          # One-off investigations\n    └── 2025-Q1/\n        └── sessions-archive.md\n```\n\n### Modular Design Principles\n\n- **Single File Responsibility**: Each document covers one specific topic (not \"everything about X\")\n- **Component Isolation**: Features are self-contained; shared concepts go in guides/ or reference/\n- **Service Layer Separation**: Guides (how-to), Reference (what is), Architecture (why/how designed)\n- **Utility Modularity**: Templates are separate from actual documentation\n\n### Documentation Flow Diagram\n\n```mermaid\ngraph TD\n    A[New Developer] --> B[getting-started/README.md]\n    B --> C[getting-started/installation.md]\n    C --> D[getting-started/first-steps.md]\n    D --> E{What to do?}\n\n    E -->|Build feature| F[guides/development/]\n    E -->|Deploy app| G[guides/infrastructure/]\n    E -->|Understand system| H[architecture/]\n    E -->|API details| I[reference/api/]\n    E -->|Specific feature| J[features/{name}/]\n\n    F --> K[feature-development-standard.md]\n    K --> L[features/templates/]\n    L --> M[Implement feature]\n\n    style A fill:#e1f5e1\n    style B fill:#fff4e6\n    style E fill:#ffe6e6\n```\n\n## Components and Interfaces\n\n### Component 1: Master Index (docs/README.md)\n\n- **Purpose:** Single entry point providing navigation to all documentation sections\n- **Interfaces:**\n  - Links to getting-started/, guides/, reference/, architecture/, features/\n  - Quick links for common tasks (run app, create feature, deploy)\n  - Documentation contribution guide\n- **Dependencies:** None (top-level document)\n- **Reuses:** Existing README.md structure, enhanced with clear sections\n\n### Component 2: Metadata Schema (docs/metadata-schema.md)\n\n- **Purpose:** Define YAML frontmatter schema and controlled vocabulary for all docs\n- **Interfaces:**\n  - Frontmatter field definitions (title, description, category, tags, order, etc.)\n  - Controlled vocabulary for categories and tags\n  - Examples for each documentation type\n- **Dependencies:** None\n- **Reuses:** Common web documentation metadata patterns\n\n### Component 3: Feature Documentation Template\n\n- **Purpose:** Standardized structure for all feature documentation\n- **Interfaces:**\n  - Template files: README.md, api-reference.md, architecture.md, developer-guide.md, user-guide.md, troubleshooting.md\n  - DOCUMENTATION_INDEX.md (optional, for complex features)\n- **Dependencies:** metadata-schema.md\n- **Reuses:** Existing templates from features/api-keys/, features/authentication/\n\n### Component 4: Section Index Files\n\n- **Purpose:** Provide navigation and context for each documentation section\n- **Interfaces:**\n  - Section overview\n  - List of documents with brief descriptions\n  - Navigation to subsections\n- **Dependencies:** None\n- **Reuses:** Existing index patterns from features/\n\n### Component 5: Migration Script\n\n- **Purpose:** Automated file moves and frontmatter generation\n- **Interfaces:**\n  - Bash script: `scripts/migrate-docs.sh`\n  - Input: mapping configuration (old path → new path)\n  - Output: git mv commands, frontmatter injection\n- **Dependencies:** `yq` (YAML processor), `git`\n- **Reuses:** None (new utility)\n\n## Data Models\n\n### Frontmatter Schema (YAML)\n\n```yaml\n---\ntitle: \"Human-readable title\"\ndescription: \"Brief description (1-2 sentences) for search and previews\"\ncategory: \"getting-started | guides | reference | architecture | features\"\ntags: [\"tag1\", \"tag2\", \"tag3\"]  # From controlled vocabulary\norder: 10  # Optional: for navigation ordering (lower = earlier)\n---\n```\n\n### Controlled Vocabulary (Tags)\n\n```\n# Technology tags\n- backend\n- frontend\n- database\n- api\n- ui\n\n# Activity tags\n- development\n- deployment\n- testing\n- architecture\n- migration\n\n# Feature tags\n- authentication\n- authorization\n- crud\n- websocket\n- file-upload\n\n# Domain tags\n- inventory\n- budget\n- user-management\n```\n\n### File Mapping Structure (for migration)\n\n```json\n{\n  \"moves\": [\n    {\n      \"from\": \"docs/AEGISX_UI_STANDARDS.md\",\n      \"to\": \"docs/reference/ui/aegisx-ui-standards.md\",\n      \"frontmatter\": {\n        \"title\": \"AegisX UI Standards\",\n        \"category\": \"reference\",\n        \"tags\": [\"ui\", \"frontend\", \"standards\"]\n      }\n    }\n  ]\n}\n```\n\n## Error Handling\n\n### Error Scenarios\n\n1. **Scenario: Broken Internal Links After Migration**\n   - **Handling:** Run link validation script post-migration; generate redirect map\n   - **User Impact:** Developers see 404 or redirects with deprecation notices\n\n2. **Scenario: Duplicate Documentation**\n   - **Handling:** During migration, identify duplicates; consolidate or archive\n   - **User Impact:** Single source of truth reduces confusion\n\n3. **Scenario: Missing Frontmatter**\n   - **Handling:** Build script generates warnings; provides defaults\n   - **User Impact:** Documentation still works but may not appear in navigation\n\n4. **Scenario: Archive Access Needed**\n   - **Handling:** Archive directory remains in repo with clear README explaining access\n   - **User Impact:** Historical context preserved but clearly marked as archived\n\n## Testing Strategy\n\n### Unit Testing\n\n- **Frontmatter Validation:**\n  - Script validates YAML frontmatter against schema\n  - Tests for required fields (title, description, category)\n  - Tests for valid controlled vocabulary values\n\n- **Link Validation:**\n  - Script checks all internal links resolve correctly\n  - Tests for broken external links (with warnings, not errors)\n\n### Integration Testing\n\n- **Web Documentation Build:**\n  - Test VitePress build completes without errors\n  - Test navigation tree generates correctly from structure\n  - Test search index includes all documents\n\n- **Migration Script:**\n  - Test dry-run mode shows correct file moves\n  - Test git history preserved after migration\n  - Test frontmatter injection works correctly\n\n### End-to-End Testing\n\n- **Developer Workflows:**\n  - New developer follows getting-started/ path successfully\n  - Feature developer finds templates and creates feature docs\n  - Infrastructure engineer finds deployment guides\n\n- **Documentation Contribution:**\n  - Contributor adds new document following standards\n  - CI/CD validates frontmatter and links\n  - Documentation appears in web build automatically\n\n## Implementation Phases\n\n### Phase 1: Foundation (Migration Preparation)\n- Create new directory structure (empty directories)\n- Create metadata-schema.md\n- Create section index templates (README.md for each section)\n- Create migration mapping configuration\n\n### Phase 2: Migration (Automated File Moves)\n- Run migration script (dry-run first)\n- Execute git mv commands\n- Inject frontmatter into moved files\n- Validate all moves completed successfully\n\n### Phase 3: Cleanup (Manual Review)\n- Review and fix broken links\n- Consolidate duplicate documentation\n- Archive outdated session notes\n- Create redirect map for legacy URLs\n\n### Phase 4: Enhancement (Web Documentation)\n- Choose static site generator (VitePress recommended)\n- Create web documentation configuration\n- Set up GitHub Pages deployment\n- Add search functionality\n\n### Phase 5: Validation (Testing & Launch)\n- Run link validation\n- Test web documentation build\n- Review navigation completeness\n- Document new contribution workflow\n- Archive old sessions/ directory\n\n## Rollout Plan\n\n1. **Week 1:** Create spec (requirements, design, tasks) - **Current Phase**\n2. **Week 2:** Implement migration script and validate dry-run\n3. **Week 3:** Execute migration and cleanup\n4. **Week 4:** Set up web documentation and launch\n5. **Ongoing:** Monitor adoption and iterate based on feedback\n\n## Success Metrics\n\n- **Findability:** Time to find documentation reduced by 50%\n- **Completeness:** 90%+ of documents have complete frontmatter\n- **Link Health:** 0 broken internal links\n- **Adoption:** 80%+ of new features use standard template\n- **Web Build:** Documentation builds in <60 seconds\n",
  "fileStats": {
    "size": 17456,
    "lines": 453,
    "lastModified": "2025-12-14T15:33:25.573Z"
  },
  "comments": []
}