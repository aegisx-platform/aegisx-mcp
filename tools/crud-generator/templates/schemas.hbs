import { Type, Static } from '@sinclair/typebox';
import { BaseIdParamSchema, PaginationQuerySchema, ErrorResponseSchema } from '../../schemas/base.schemas';

// Base {{ModuleName}} Schema
export const {{ModuleName}}Schema = Type.Object({
  {{#each columns}}
  {{name}}: {{{typeboxType}}}{{#unless @last}},{{/unless}}
  {{/each}}
});

// Create Schema (without auto-generated fields)
export const Create{{ModuleName}}Schema = Type.Object({
  {{#each columns}}
  {{#unless (or isPrimaryKey (eq name 'created_at') (eq name 'updated_at'))}}
  {{name}}: {{{typeboxType}}}{{#unless @last}},{{/unless}}
  {{/unless}}
  {{/each}}
});

// Update Schema (partial, without auto-generated fields)
export const Update{{ModuleName}}Schema = Type.Partial(
  Type.Object({
    {{#each columns}}
    {{#unless (or isPrimaryKey (eq name 'created_at') (eq name 'updated_at'))}}
    {{name}}: {{{typeboxType}}}{{#unless @last}},{{/unless}}
    {{/unless}}
    {{/each}}
  })
);

// ID Parameter Schema
export const {{ModuleName}}IdParamSchema = Type.Object({
  id: Type.Union([Type.String(), Type.Number()])
});

// Query Schemas
export const Get{{ModuleName}}QuerySchema = Type.Object({
  include: Type.Optional(Type.Union([
    Type.String(),
    Type.Array(Type.String())
  ]))
});

export const List{{ModuleName}}QuerySchema = Type.Intersect([
  PaginationQuerySchema,
  Type.Object({
    search: Type.Optional(Type.String()),
    sortBy: Type.Optional(Type.String({ default: '{{#each primaryKey}}{{this}}{{#unless @last}}, {{/unless}}{{/each}}' })),
    sortOrder: Type.Optional(Type.Union([
      Type.Literal('asc'),
      Type.Literal('desc')
    ], { default: 'desc' })),
    include: Type.Optional(Type.Union([
      Type.String(),
      Type.Array(Type.String())
    ]))
  })
]);

// Response Schemas
export const {{ModuleName}}ResponseSchema = Type.Object({
  success: Type.Boolean(),
  data: {{ModuleName}}Schema
});

export const {{ModuleName}}ListResponseSchema = Type.Object({
  success: Type.Boolean(),
  data: Type.Array({{ModuleName}}Schema),
  pagination: Type.Object({
    page: Type.Number(),
    limit: Type.Number(),
    total: Type.Number(),
    totalPages: Type.Number()
  })
});

// Export types
export type {{ModuleName}} = Static<typeof {{ModuleName}}Schema>;
export type Create{{ModuleName}} = Static<typeof Create{{ModuleName}}Schema>;
export type Update{{ModuleName}} = Static<typeof Update{{ModuleName}}Schema>;
export type {{ModuleName}}IdParam = Static<typeof {{ModuleName}}IdParamSchema>;
export type Get{{ModuleName}}Query = Static<typeof Get{{ModuleName}}QuerySchema>;
export type List{{ModuleName}}Query = Static<typeof List{{ModuleName}}QuerySchema>;

{{#if withEvents}}
// WebSocket Event Schemas
export const {{ModuleName}}CreatedEventSchema = Type.Object({
  type: Type.Literal('{{moduleName}}.created'),
  data: {{ModuleName}}Schema
});

export const {{ModuleName}}UpdatedEventSchema = Type.Object({
  type: Type.Literal('{{moduleName}}.updated'),
  data: {{ModuleName}}Schema
});

export const {{ModuleName}}DeletedEventSchema = Type.Object({
  type: Type.Literal('{{moduleName}}.deleted'),
  data: Type.Object({
    id: Type.Union([Type.String(), Type.Number()])
  })
});

export type {{ModuleName}}CreatedEvent = Static<typeof {{ModuleName}}CreatedEventSchema>;
export type {{ModuleName}}UpdatedEvent = Static<typeof {{ModuleName}}UpdatedEventSchema>;
export type {{ModuleName}}DeletedEvent = Static<typeof {{ModuleName}}DeletedEventSchema>;
{{/if}}